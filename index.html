<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Estudio Socioeconómico - SMDIF Mineral de la Reforma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fuentes e íconos -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet (mapa interactivo) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --vino: #75142e;
      --dorado: #bb935c;
      --tinta: #1b1b1b;
      --papel: #ffffff;

      --primario: var(--vino);
      --secundario: var(--dorado);
      --fondo-claro: #f9f6f7;
      --texto: var(--tinta);
      --borde-suave: #e4d7d9;
      --radius-xl: 18px;
      --shadow-suave: 0 8px 22px rgba(0,0,0,0.06);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--fondo-claro);
      color: var(--texto);
    }

    /* HEADER */

    header {
      background: var(--papel);
      padding: 14px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-suave);
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 2px solid var(--vino);
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-placeholder {
      width: 46px;
      height: 46px;
      border-radius: 8px;
      background: var(--vino);
      color: var(--papel);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      font-weight: 600;
    }

    .title-area h1 {
      font-size: 19px;
      margin: 0;
      font-weight: 700;
      color: var(--vino);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .title-area h1 i {
      color: var(--dorado);
      font-size: 17px;
    }

    .title-area span {
      font-size: 11px;
      color: var(--tinta);
      opacity: 0.85;
    }

    nav {
      display: flex;
      gap: 10px;
      font-size: 10px;
    }

    nav a {
      text-decoration: none;
      color: var(--vino);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      transition: all 0.2s;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    nav a i {
      font-size: 10px;
    }

    nav a:hover,
    nav a.activo {
      background: var(--vino);
      color: var(--papel);
      border-color: var(--vino);
    }

    /* LAYOUT */

    main {
      padding: 24px 40px 40px;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(280px, 1fr);
      gap: 24px;
      align-items: flex-start;
    }

    .card {
      background: var(--papel);
      border-radius: var(--radius-xl);
      padding: 20px 20px 16px;
      box-shadow: var(--shadow-suave);
      border: 1px solid var(--borde-suave);
    }

    .card h2 {
      margin: 0 0 4px;
      font-size: 18px;
      color: var(--vino);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card h2 i {
      color: var(--dorado);
      font-size: 16px;
    }

    .card p.desc {
      margin: 0 0 16px;
      font-size: 11px;
      color: var(--tinta);
      opacity: 0.85;
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }

    .card p.desc i {
      color: var(--dorado);
      margin-top: 2px;
    }

    /* PASOS */

    .progress-container {
      width: 100%;
      background: #f1e5e7;
      border-radius: 999px;
      height: 7px;
      margin-bottom: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 7px;
      width: 0%;
      background: linear-gradient(90deg, var(--vino), var(--dorado));
      transition: width 0.25s ease;
    }

    .steps-indicator {
      display: flex;
      gap: 8px;
      font-size: 9px;
      margin-bottom: 12px;
      color: var(--tinta);
      opacity: 0.8;
      flex-wrap: wrap;
    }

    .step-pill {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px dashed #e4d7d9;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .step-pill i {
      color: var(--vino);
      font-size: 9px;
    }

    .step-pill span {
      font-weight: 500;
    }

    .step-pill.activo-step {
      background: var(--vino);
      color: var(--papel);
      border-color: var(--vino);
    }

    .step-pill.activo-step i {
      color: var(--dorado);
    }

    /* FORMULARIO */

    form {
      display: flex;
      flex-direction: column;
      gap: 14px;
      font-size: 11px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    label {
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: var(--tinta);
    }

    label i {
      color: var(--vino);
      font-size: 10px;
    }

    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 9px;
      border: 1px solid var(--borde-suave);
      font-family: inherit;
      font-size: 11px;
      outline: none;
      transition: all 0.2s;
      background: #fdfbfb;
      color: var(--tinta);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--vino);
      box-shadow: 0 0 0 2px rgba(117,20,46,0.08);
      background: var(--papel);
    }

    textarea {
      resize: vertical;
      min-height: 48px;
    }

    .step {
      display: none;
      animation: fadeIn 0.25s ease;
    }

    .step.activo {
      display: block;
    }

    .step-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--tinta);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .step-title i {
      color: var(--dorado);
      font-size: 13px;
    }

    .hint {
      font-size: 9px;
      color: var(--tinta);
      opacity: 0.7;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
    }

    .hint i {
      color: var(--dorado);
    }

    .acciones {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }

    .btn {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      font-size: 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .btn i {
      font-size: 10px;
    }

    .btn-sec {
      background: var(--papel);
      color: var(--vino);
      border: 1px solid var(--vino);
    }

    .btn-sec:hover {
      background: var(--vino);
      color: var(--papel);
    }

    .btn-primary {
      background: var(--vino);
      color: var(--papel);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-suave);
      background: #5e0f24;
    }

    .btn-submit {
      background: var(--dorado);
      color: var(--papel);
    }

    .btn-submit:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-suave);
      background: #a87a45;
    }

    .btn-map {
      background: var(--vino);
      color: var(--papel);
      margin-top: 4px;
    }

    .btn-map:hover {
      background: #5e0f24;
      box-shadow: var(--shadow-suave);
    }

    /* SIDEBAR */

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .sidebar-card {
      background: var(--papel);
      border-radius: var(--radius-xl);
      padding: 12px 12px 10px;
      box-shadow: var(--shadow-suave);
      border: 1px solid var(--borde-suave);
      font-size: 10px;
    }

    .sidebar-card h3 {
      margin: 0 0 6px;
      font-size: 12px;
      color: var(--vino);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .sidebar-card h3 i {
      color: var(--dorado);
      font-size: 12px;
    }

    .tag {
      font-size: 8px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f1e5e7;
      color: var(--vino);
      font-weight: 500;
    }

    #mapa {
      width: 100%;
      height: 180px;
      border-radius: 12px;
      border: 1px solid var(--borde-suave);
      overflow: hidden;
    }

    #ingresoInfo {
      margin-top: 4px;
      font-size: 9px;
      color: var(--tinta);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    #ingresoInfo i {
      color: var(--dorado);
    }

    canvas {
      width: 100% !important;
      max-height: 130px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
      nav {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="logo-area">
    <div class="logo-placeholder">
      <i class="fa-solid fa-hands-holding-child"></i>
    </div>
    <div class="title-area">
      <h1>
        <i class="fa-solid fa-file-pen"></i>
        Estudio Socioeconómico
      </h1>
      <span>SMDIF Mineral de la Reforma · Plataforma de captura</span>
    </div>
  </div>
  <nav>
    <a href="#form" class="activo"><i class="fa-solid fa-list-check"></i><span>Encuesta</span></a>
    <a href="#graficos"><i class="fa-solid fa-chart-column"></i><span>Gráficos</span></a>
    <a href="#mapas"><i class="fa-solid fa-location-dot"></i><span>Mapa</span></a>
  </nav>
</header>

<main>
  <!-- FORMULARIO -->
  <section class="card" id="form">
    <h2><i class="fa-solid fa-users-viewfinder"></i> Captura de Estudio Socioeconómico</h2>
    <p class="desc">
      <i class="fa-solid fa-circle-info"></i>
      Complete los datos paso a paso. El panel derecho muestra ejemplos de indicadores y el mapa
      ayuda a ubicar el domicilio registrado.
    </p>

    <!-- Pasos -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="steps-indicator" id="stepsIndicator">
      <div class="step-pill activo-step">
        <i class="fa-solid fa-id-card"></i><span>1. Datos generales</span>
      </div>
      <div class="step-pill">
        <i class="fa-solid fa-people-group"></i><span>2. Estructura familiar</span>
      </div>
      <div class="step-pill">
        <i class="fa-solid fa-house-chimney"></i><span>3. Vivienda e ingresos</span>
      </div>
      <div class="step-pill">
        <i class="fa-solid fa-clipboard-list"></i><span>4. Observaciones</span>
      </div>
    </div>

    <form id="encuestaForm">
      <!-- Paso 1 -->
      <div class="step activo" data-step="1">
        <div class="step-title">
          <i class="fa-solid fa-id-card-clip"></i>
          Datos del beneficiario y solicitante
        </div>
        <div class="grid-2">
          <div class="field-group">
            <label><i class="fa-solid fa-user"></i>Nombre del beneficiario</label>
            <input type="text" name="nombre_beneficiario" required />
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-address-card"></i>CURP</label>
            <input type="text" name="curp" />
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-venus-mars"></i>Género</label>
            <select name="genero">
              <option value="">Seleccione</option>
              <option>Femenino</option>
              <option>Masculino</option>
              <option>No especifica</option>
            </select>
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-cake-candles"></i>Fecha de nacimiento</label>
            <input type="date" name="fecha_nacimiento" />
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-road"></i>Domicilio (calle y número)</label>
            <input type="text" name="domicilio" />
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-location-dot"></i>Colonia / Localidad</label>
            <input type="text" name="colonia" />
          </div>
        </div>
      </div>

      <!-- Paso 2 -->
      <div class="step" data-step="2">
        <div class="step-title">
          <i class="fa-solid fa-people-group"></i>
          Estructura familiar
        </div>
        <div class="hint">
          <i class="fa-solid fa-lightbulb"></i>
          Registre a cada integrante del hogar con edad, parentesco, escolaridad y ocupación.
        </div>
        <textarea
          name="estructura_familiar"
          placeholder="Ejemplo: Ana Pérez - 35 - Madre - Secundaria - Empleada doméstica&#10;Luis Pérez - 12 - Hijo - Secundaria - Estudiante"
        ></textarea>
      </div>

      <!-- Paso 3 -->
      <div class="step" data-step="3">
        <div class="step-title">
          <i class="fa-solid fa-house"></i>
          Vivienda, servicios e ingresos
        </div>
        <div class="grid-2">
          <div class="field-group">
            <label><i class="fa-solid fa-house-chimney"></i>Tipo de vivienda</label>
            <select name="tipo_vivienda">
              <option value="">Seleccione</option>
              <option>Propia</option>
              <option>Rentada</option>
              <option>Prestada</option>
              <option>Irregular</option>
            </select>
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-bricks"></i>Material predominante</label>
            <select name="material">
              <option value="">Seleccione</option>
              <option>Block / Tabique</option>
              <option>Adobe</option>
              <option>Madera / Lámina</option>
            </select>
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-faucet-drip"></i>Servicios con los que cuenta</label>
            <textarea
              name="servicios"
              placeholder="Agua entubada, energía eléctrica, drenaje, gas, internet, etc."
            ></textarea>
          </div>
          <div class="field-group">
            <label><i class="fa-solid fa-coins"></i>Ingreso familiar mensual aproximado (MXN)</label>
            <input type="number" name="ingreso_mensual" min="0" id="ingresoInput" />
          </div>
        </div>
        <button type="button" class="btn btn-map" id="btnLocate">
          <i class="fa-solid fa-location-crosshairs"></i>
          Ubicar domicilio en el mapa
        </button>
        <div class="hint">
          <i class="fa-solid fa-circle-question"></i>
          El mapa del panel derecho intentará localizar el domicilio usando la calle y colonia capturadas.
        </div>
      </div>

      <!-- Paso 4 -->
      <div class="step" data-step="4">
        <div class="step-title">
          <i class="fa-solid fa-clipboard-list"></i>
          Problemática, observaciones y dictamen
        </div>
        <div class="field-group">
          <label><i class="fa-solid fa-heart-pulse"></i>Problemática y padecimiento actual</label>
          <textarea name="problematica"></textarea>
        </div>
        <div class="field-group">
          <label><i class="fa-solid fa-hand-holding-heart"></i>Plan social / Apoyo sugerido</label>
          <textarea name="plan_social"></textarea>
        </div>
        <div class="field-group">
          <label><i class="fa-solid fa-comment-dots"></i>Observaciones de Trabajo Social</label>
          <textarea name="observaciones_ts"></textarea>
        </div>
      </div>

      <!-- Controles -->
      <div class="acciones">
        <button type="button" class="btn btn-sec" id="btnPrev">
          <i class="fa-solid fa-arrow-left"></i> Anterior
        </button>
        <button type="button" class="btn btn-primary" id="btnNext">
          Siguiente <i class="fa-solid fa-arrow-right"></i>
        </button>
        <button type="submit" class="btn btn-submit" id="btnSubmit" style="display:none;">
          <i class="fa-solid fa-paper-plane"></i> Enviar encuesta
        </button>
      </div>
    </form>
  </section>

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-card" id="graficos">
      <h3>
        <span><i class="fa-solid fa-chart-column"></i> Indicadores rápidos</span>
        <span class="tag">Demo</span>
      </h3>
      <canvas id="chartIngresos"></canvas>
      <div id="ingresoInfo">
        <i class="fa-solid fa-circle-info"></i>
        Ingrese un monto en el formulario para ver en qué rango se ubica el caso.
      </div>
    </div>

    <div class="sidebar-card" id="mapas">
      <h3>
        <span><i class="fa-solid fa-location-dot"></i> Mapa de localización</span>
        <span class="tag">Interactivo</span>
      </h3>
      <div id="mapa"></div>
      <div class="hint">
        <i class="fa-solid fa-hand-pointer"></i>
        Puede acercar, alejar y mover el mapa. Al usar "Ubicar domicilio" se marcará la ubicación sugerida.
      </div>
    </div>
  </aside>
</main>

<script>
  // --------- LÓGICA MULTIPASO ----------
  const steps = document.querySelectorAll(".step");
  const progressBar = document.getElementById("progressBar");
  const btnPrev = document.getElementById("btnPrev");
  const btnNext = document.getElementById("btnNext");
  const btnSubmit = document.getElementById("btnSubmit");
  const stepPills = document.querySelectorAll("#stepsIndicator .step-pill");

  let currentStep = 1;
  const totalSteps = steps.length;

  function actualizarVista() {
    steps.forEach(step => {
      step.classList.toggle("activo", Number(step.dataset.step) === currentStep);
    });

    // progreso
    const pct = (currentStep - 1) / (totalSteps - 1) * 100;
    progressBar.style.width = pct + "%";

    // pills
    stepPills.forEach((pill, idx) => {
      pill.classList.toggle("activo-step", idx + 1 === currentStep);
    });

    // botones
    btnPrev.style.visibility = currentStep === 1 ? "hidden" : "visible";
    btnNext.style.display = currentStep === totalSteps ? "none" : "inline-flex";
    btnSubmit.style.display = currentStep === totalSteps ? "inline-flex" : "none";
  }

  btnPrev.addEventListener("click", () => {
    if (currentStep > 1) {
      currentStep--;
      actualizarVista();
    }
  });

  btnNext.addEventListener("click", () => {
    if (currentStep < totalSteps) {
      currentStep++;
      actualizarVista();
    }
  });

  document.getElementById("encuestaForm").addEventListener("submit", (e) => {
    e.preventDefault();
    alert("Encuesta enviada (demo). Aquí se conectaría con tu API o base de datos institucional.");
  });

  actualizarVista();

  // --------- GRÁFICO DEMO + INGRESO DINÁMICO ----------
  const ctx = document.getElementById("chartIngresos").getContext("2d");
  const chartIngresos = new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["0 - 2,000", "2,001 - 5,000", "5,001 - 8,000", "8,001 o más"],
      datasets: [{
        label: "Casos registrados (ejemplo)",
        data: [8, 15, 6, 3],
        backgroundColor: "#75142e",
        borderColor: "#1b1b1b",
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        legend: { display: false }
      },
      scales: {
        x: {
          ticks: { font: { size: 9 }, color: "#1b1b1b" },
          grid: { display: false }
        },
        y: {
          ticks: { font: { size: 8 }, color: "#1b1b1b" },
          beginAtZero: true,
          grid: { color: "#f1e5e7" }
        }
      }
    }
  });

  const ingresoInput = document.getElementById("ingresoInput");
  const ingresoInfo = document.getElementById("ingresoInfo");

  ingresoInput.addEventListener("input", () => {
    const val = Number(ingresoInput.value || 0);
    if (!val) {
      ingresoInfo.innerHTML =
        '<i class="fa-solid fa-circle-info"></i> Ingrese un monto en el formulario para ver en qué rango se ubica el caso.';
      return;
    }

    let rango = "";
    if (val <= 2000) rango = "0 - 2,000";
    else if (val <= 5000) rango = "2,001 - 5,000";
    else if (val <= 8000) rango = "5,001 - 8,000";
    else rango = "8,001 o más";

    ingresoInfo.innerHTML =
      '<i class="fa-solid fa-coins"></i> Ingreso capturado: <strong>$' +
      val.toLocaleString("es-MX") +
      ' MXN</strong>. Rango de referencia: <strong>' +
      rango +
      "</strong>.";

  });

  // --------- MAPA INTERACTIVO (LEAFLET) ----------
  const mapaDiv = document.getElementById("mapa");

  // Coordenadas iniciales aproximadas de Mineral de la Reforma
  const map = L.map("mapa").setView([20.09, -98.70], 12);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap"
  }).addTo(map);

  let marker;

  function ubicarDomicilio() {
    const domicilio = document.querySelector('[name="domicilio"]').value.trim();
    const colonia = document.querySelector('[name="colonia"]').value.trim();

    if (!domicilio && !colonia) {
      alert("Capture al menos el domicilio o la colonia/localidad para poder ubicar en el mapa.");
      return;
    }

    const query = encodeURIComponent(
      `${domicilio} ${colonia} Mineral de la Reforma, Hidalgo, México`
    );

    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=1&addressdetails=1`;

    fetch(url, {
      headers: {
        "Accept-Language": "es"
      }
    })
      .then((res) => res.json())
      .then((data) => {
        if (data && data.length > 0) {
          const { lat, lon, display_name } = data[0];
          const latNum = parseFloat(lat);
          const lonNum = parseFloat(lon);

          if (marker) {
            marker.remove();
          }

          marker = L.marker([latNum, lonNum]).addTo(map);
          map.setView([latNum, lonNum], 17);
          marker.bindPopup(
            "<strong>Domicilio localizado</strong><br>" + display_name
          ).openPopup();
        } else {
          alert("No se encontró el domicilio. Verifique los datos o intente ser más específico.");
        }
      })
      .catch(() => {
        alert("Ocurrió un error al consultar la ubicación. Intente nuevamente.");
      });
  }

  document.getElementById("btnLocate").addEventListener("click", ubicarDomicilio);

</script>

</body>
</html>

