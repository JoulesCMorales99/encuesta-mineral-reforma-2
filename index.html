<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Estudio Socioeconómico - SMDIF Mineral de la Reforma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fuentes e íconos -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet (mapa) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root{
      /* Paleta institucional */
      --vino:#75142e;
      --dorado:#bb935c;
      --tinta:#1b1b1b;
      --papel:#ffffff;

      /* Espaciado y decoración */
      --space-1:8px;
      --space-2:12px;
      --space-3:18px;
      --space-4:24px;
      --space-5:32px;
      --radius-lg:16px;
      --radius-xl:22px;
      --shadow:0 8px 28px rgba(0,0,0,.06);
      --borde:#e7d9dc;
      --fondo:#fbf9fa;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Montserrat",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      color:var(--tinta);
      background:var(--fondo);
      line-height:1.6;
      letter-spacing:.2px;
    }

    /* ENCABEZADO */
    header{
      background:var(--papel);
      padding:20px 48px;
      display:flex;align-items:center;justify-content:space-between;
      border-bottom:3px solid var(--vino);
      box-shadow:var(--shadow);
      position:sticky;top:0;z-index:10;
    }
    .logo-area{display:flex;align-items:center;gap:14px}
    .logo{width:52px;height:52px;border-radius:12px;background:var(--vino);color:#fff;display:grid;place-items:center;font-size:22px}
    .brand h1{margin:0;font-size:22px;color:var(--vino)}
    .brand small{display:block;margin-top:4px;font-size:12px;opacity:.9}

    nav{display:flex;gap:12px}
    nav a{
      text-decoration:none;border:1px solid var(--vino);color:var(--vino);
      padding:8px 14px;border-radius:999px;font-size:12px
    }
    nav a:hover,nav a.activo{background:var(--vino);color:#fff}

    /* LAYOUT */
    main{
      max-width:1200px;
      margin:32px auto 48px;
      padding:0 24px;
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(320px,1fr);
      gap:32px;
      align-items:flex-start;
    }
    .card{
      background:#fff;border:1px solid var(--borde);
      border-radius:var(--radius-xl);
      padding:28px;
      box-shadow:var(--shadow);
    }
    .card h2{margin:0 0 10px;color:var(--vino);display:flex;gap:10px;align-items:center}
    .desc{margin:0 0 16px;font-size:12px;opacity:.85}
    .tag{font-size:11px;background:#f3e9eb;color:var(--vino);border-radius:999px;padding:2px 10px}

    /* PROGRESO / PASTILLAS */
    .progress{height:8px;background:#f1e5e7;border-radius:999px;margin:8px 0 18px;overflow:hidden}
    .progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--vino),var(--dorado));transition:width .25s ease}
    .pills{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:18px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 12px;border-radius:999px;border:1px dashed var(--borde);
      font-size:12px;background:#fff
    }
    .pill.activa{background:var(--vino);border-color:var(--vino);color:#fff}

    /* FORM */
    form{display:flex;flex-direction:column;gap:20px}
    .step{display:none}
    .step.activo{display:block}
    .field{display:flex;flex-direction:column;gap:8px}
    label{font-weight:600;display:inline-flex;gap:8px;align-items:center}
    label i{color:var(--vino)}
    input,select,textarea{
      width:100%;
      padding:12px 14px;
      border:1px solid var(--borde);
      border-radius:12px;
      background:#fff;
      outline:none;
      transition:border-color .2s, box-shadow .2s;
      font-size:14px;
    }
    textarea{min-height:64px;resize:vertical}
    input:focus,select:focus,textarea:focus{
      border-color:var(--vino);
      box-shadow:0 0 0 3px rgba(117,20,46,.08);
    }
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px}
    .grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px}

    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .chip{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--borde);padding:8px 12px;border-radius:999px;background:#fff}
    .chip input{width:auto}

    .acciones{display:flex;justify-content:flex-end;gap:12px;margin-top:6px}
    .btn{padding:10px 16px;border-radius:999px;border:1px solid var(--vino);background:#fff;color:var(--vino);cursor:pointer;font-weight:600}
    .btn.primary{background:var(--vino);color:#fff}
    .btn.gold{background:var(--dorado);border-color:var(--dorado);color:#fff}
    .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}

    table{width:100%;border-collapse:separate;border-spacing:0 10px}
    th,td{font-size:13px;padding:10px 12px;background:#fff;border:1px solid var(--borde)}
    th{background:#f7efea}
    tr td:first-child,tr th:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    tr td:last-child,tr th:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}

    /* SIDEBAR */
    .sidebar{display:flex;flex-direction:column;gap:24px}
    .sidebar h3{margin:0 0 10px;color:var(--vino);display:flex;align-items:center;justify-content:space-between}
    #mapa{width:100%;height:260px;border-radius:14px;border:1px solid var(--borde);overflow:hidden}
    canvas{width:100% !important;max-height:180px}

    /* RESPONSIVE */
    @media (max-width:1000px){
      main{grid-template-columns:1fr;gap:26px}
    }
    @media (max-width:640px){
      header{padding:18px 22px;flex-direction:column;align-items:flex-start;gap:10px}
      .grid-2,.grid-3{grid-template-columns:1fr}
      .pills{gap:8px}
    }
  </style>
</head>
<body>

  <header>
    <div class="logo-area">
      <div class="logo"><i class="fa-solid fa-hands-holding-child"></i></div>
      <div class="brand">
        <h1><i class="fa-solid fa-file-pen"></i> Estudio Socioeconómico</h1>
        <small>SMDIF Mineral de la Reforma · Plataforma de captura</small>
      </div>
    </div>
    <nav>
      <a href="#form" class="activo"><i class="fa-solid fa-list-check"></i> Encuesta</a>
      <a href="#graficos"><i class="fa-solid fa-chart-column"></i> Gráficos</a>
      <a href="#mapas"><i class="fa-solid fa-location-dot"></i> Mapa</a>
    </nav>
  </header>

  <main>
    <!-- FORMULARIO -->
    <section class="card" id="form">
      <h2><i class="fa-solid fa-users-viewfinder"></i> Captura del Estudio</h2>
      <p class="desc">Completa cada paso. Los totales se calculan automáticamente; el mapa te ayuda a localizar el domicilio.</p>

      <div class="progress"><span id="bar"></span></div>

      <div class="pills" id="pills">
        <span class="pill activa"><i class="fa-solid fa-clipboard"></i>1. Encabezado</span>
        <span class="pill"><i class="fa-solid fa-user"></i>2. Beneficiario</span>
        <span class="pill"><i class="fa-solid fa-user-plus"></i>3. Solicitante/Salud</span>
        <span class="pill"><i class="fa-solid fa-people-group"></i>4. Estructura familiar</span>
        <span class="pill"><i class="fa-solid fa-coins"></i>5. Ingresos</span>
        <span class="pill"><i class="fa-solid fa-house-chimney"></i>6. Vivienda y servicios</span>
        <span class="pill"><i class="fa-solid fa-wallet"></i>7. Egresos</span>
        <span class="pill"><i class="fa-solid fa-bowl-food"></i>8. Alimentación</span>
        <span class="pill"><i class="fa-solid fa-file-signature"></i>9. Dictamen y firmas</span>
      </div>

      <form id="encuesta">
        <!-- 1. ENCABEZADO -->
        <div class="step activo" data-step="1">
          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-calendar-day"></i>Fecha de elaboración</label>
              <input type="date" name="fecha_elaboracion" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-flag"></i>Estado del beneficiario / expediente</label>
              <select name="estado_beneficiario">
                <option value="">Seleccione</option>
                <option>Vigente</option><option>Nuevo</option><option>En evaluación</option><option>Concluido</option><option>Baja</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-tag"></i>Clasificación</label>
              <input type="text" name="clasificacion" placeholder="Alta / Media / Baja u otro" />
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-city"></i>Municipio</label>
              <input type="text" name="municipio" value="Mineral de la Reforma" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-map"></i>Estado</label>
              <input type="text" name="estado" value="Hidalgo" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-hashtag"></i>Folio</label>
              <input type="text" name="folio" />
            </div>
          </div>

          <div class="chips" style="margin-top:6px">
            <label class="chip"><input type="checkbox" name="atencion_inmediata" /> Atención inmediata</label>
            <label class="chip"><input type="checkbox" name="discapacidad" /> Discapacidad</label>
          </div>

          <div class="field">
            <label><i class="fa-solid fa-hand-holding-heart"></i>Apoyo que solicita</label>
            <textarea name="apoyo_solicita" placeholder="Describa el tipo de apoyo solicitado"></textarea>
          </div>
        </div>

        <!-- 2. BENEFICIARIO -->
        <div class="step" data-step="2">
          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-user"></i>Nombre del beneficiario</label>
              <input type="text" name="nombre_beneficiario" required />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-venus-mars"></i>Género</label>
              <select name="genero_beneficiario">
                <option value="">Seleccione</option>
                <option>Femenino</option><option>Masculino</option><option>No especifica</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-cake-candles"></i>Fecha de nacimiento</label>
              <input type="date" name="fecha_nacimiento" id="fnac" />
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-hourglass-half"></i>Edad</label>
              <input type="number" id="edad" name="edad" min="0" placeholder="Se calcula automáticamente" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-ring"></i>Estado civil</label>
              <select name="estado_civil">
                <option value="">Seleccione</option>
                <option>Soltero(a)</option><option>Casado(a)</option><option>Unión libre</option><option>Divorciado(a)</option><option>Viudo(a)</option><option>Separado(a)</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-school"></i>Nivel de estudios</label>
              <select name="nivel_estudios">
                <option value="">Seleccione</option>
                <option>Sin estudios</option><option>Primaria</option><option>Secundaria</option>
                <option>Bachillerato</option><option>Técnico</option><option>Licenciatura</option><option>Posgrado</option>
              </select>
            </div>
          </div>

          <div class="grid-2">
            <div class="field">
              <label><i class="fa-solid fa-briefcase"></i>Ocupación actual</label>
              <input type="text" name="ocupacion_actual" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-phone"></i>Teléfono</label>
              <input type="tel" name="telefono_beneficiario" />
            </div>
          </div>

          <div class="grid-2">
            <div class="field">
              <label><i class="fa-solid fa-road"></i>Domicilio (calle y número)</label>
              <input type="text" name="domicilio" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-location-dot"></i>Colonia / Localidad</label>
              <input type="text" name="colonia" />
            </div>
          </div>

          <button class="btn primary" type="button" id="btnLocate1" style="margin-top:6px">
            <i class="fa-solid fa-location-crosshairs"></i> Ubicar domicilio en el mapa
          </button>
        </div>

        <!-- 3. SOLICITANTE / SALUD -->
        <div class="step" data-step="3">
          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-user-plus"></i>Nombre del solicitante</label>
              <input type="text" name="nombre_solicitante" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-venus-mars"></i>Género</label>
              <select name="genero_solicitante">
                <option value="">Seleccione</option>
                <option>Femenino</option><option>Masculino</option><option>No especifica</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-hourglass-half"></i>Edad</label>
              <input type="number" name="edad_solicitante" min="0" />
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-phone"></i>Número de teléfono</label>
              <input type="tel" name="tel_solicitante" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-people-arrows"></i>Parentesco con el beneficiario</label>
              <input type="text" name="parentesco" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-briefcase"></i>Ocupación</label>
              <input type="text" name="ocupacion_solicitante" />
            </div>
          </div>

          <div class="chips">
            <label class="chip"><input type="checkbox" name="subsecuente" /> Subsecuente</label>
          </div>

          <div class="grid-2">
            <div class="field">
              <label><i class="fa-solid fa-house-medical"></i>Institución médica habitual</label>
              <select name="institucion_medica">
                <option value="">Seleccione</option>
                <option>Centro de Salud</option><option>Hospital General</option>
                <option>IMSS</option><option>ISSSTE</option><option>Privado</option><option>Otra</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-shield-heart"></i>Institución de seguridad social</label>
              <select name="seguridad_social">
                <option value="">Seleccione</option>
                <option>IMSS</option><option>ISSSTE</option><option>INSABI/Seguro Popular</option>
                <option>ISSTEH</option><option>No cuenta</option><option>Otra</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label><i class="fa-solid fa-notes-medical"></i>Problemática y padecimiento actual</label>
            <textarea name="problematica"></textarea>
          </div>
        </div>

        <!-- 4. ESTRUCTURA FAMILIAR -->
        <div class="step" data-step="4">
          <div class="field">
            <label><i class="fa-solid fa-people-group"></i>Estructura familiar</label>
            <table id="tablaFamilia">
              <thead>
                <tr>
                  <th>Apellido paterno/materno y nombre(s)</th>
                  <th>Edad</th>
                  <th>Parentesco</th>
                  <th>Escolaridad</th>
                  <th>Ocupación</th>
                  <th style="width:70px">Acción</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <button class="btn" type="button" id="agregarIntegrante">
              <i class="fa-solid fa-plus"></i> Agregar integrante
            </button>
          </div>
        </div>

        <!-- 5. INGRESOS -->
        <div class="step" data-step="5">
          <div class="grid-3">
            <div class="field"><label><i class="fa-solid fa-person"></i>Jefe de familia (MXN)</label><input type="number" min="0" step="1" id="ing_jefe" value="0"></div>
            <div class="field"><label><i class="fa-solid fa-person-dress"></i>Esposa (MXN)</label><input type="number" min="0" step="1" id="ing_esposa" value="0"></div>
            <div class="field"><label><i class="fa-solid fa-children"></i>Hijos (MXN)</label><input type="number" min="0" step="1" id="ing_hijos" value="0"></div>
          </div>
          <div class="grid-2">
            <div class="field"><label><i class="fa-solid fa-plus"></i>Otros (MXN)</label><input type="number" min="0" step="1" id="ing_otros" value="0"></div>
            <div class="field"><label><i class="fa-solid fa-equals"></i>Total mensual (MXN)</label><input type="number" id="ing_total" readonly></div>
          </div>
          <p class="desc"><i class="fa-solid fa-circle-info"></i> Los ingresos alimentan el gráfico comparativo de la derecha.</p>
        </div>

        <!-- 6. VIVIENDA Y SERVICIOS -->
        <div class="step" data-step="6">
          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-house-chimney"></i>Tipo de vivienda</label>
              <select name="tipo_vivienda">
                <option value="">Seleccione</option>
                <option>Propia</option><option>Rentada</option><option>Prestada</option><option>Irregular</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-users"></i>Dependientes económicos</label>
              <input type="number" name="dependientes" min="0" value="0" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-building"></i>Material de construcción (predominante)</label>
              <select name="material">
                <option value="">Seleccione</option>
                <option>Block / Tabique</option><option>Adobe</option><option>Madera</option><option>Otro</option>
              </select>
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-building-columns"></i>Techo</label>
              <select name="techo">
                <option value="">Seleccione</option>
                <option>Loza</option><option>Lámina</option><option>Cartón</option><option>Teja</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-border-all"></i>Piso</label>
              <select name="piso">
                <option value="">Seleccione</option>
                <option>Cemento</option><option>Loseta / Mosaico</option><option>Tierra</option>
              </select>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-clipboard-list"></i>Características</label>
              <input type="text" name="caracteristicas" placeholder="N° de cuartos, hacinamiento, etc." />
            </div>
          </div>

          <div class="field">
            <label><i class="fa-solid fa-box-archive"></i>Propiedades diversas</label>
            <textarea name="propiedades_diversas" placeholder="Vehículos, terrenos, herramientas, etc."></textarea>
          </div>

          <div class="field">
            <label><i class="fa-solid fa-plug"></i>Servicios con los que cuenta</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="servicios" value="WC" /> WC</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Letrina" /> Letrina</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Drenaje" /> Drenaje</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Alumbrado público" /> Alumbrado público</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Agua" /> Agua</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Electricidad" /> Electricidad</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Cable" /> Cable</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Teléfono" /> Teléfono</label>
              <label class="chip"><input type="checkbox" name="servicios" value="Internet" /> Internet</label>
            </div>
          </div>
        </div>

        <!-- 7. EGRESOS -->
        <div class="step" data-step="7">
          <div class="grid-3">
            <div class="field"><label><i class="fa-solid fa-basket-shopping"></i>Alimentación</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_alim"></div>
            <div class="field"><label><i class="fa-solid fa-graduation-cap"></i>Educación</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_edu"></div>
            <div class="field"><label><i class="fa-solid fa-house"></i>Habitación (renta/hipoteca)</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_hab"></div>
          </div>
          <div class="grid-3">
            <div class="field"><label><i class="fa-solid fa-stethoscope"></i>Servicio médico</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_med"></div>
            <div class="field"><label><i class="fa-regular fa-lightbulb"></i>Luz</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_luz"></div>
            <div class="field"><label><i class="fa-solid fa-faucet"></i>Agua</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_agua"></div>
          </div>
          <div class="grid-3">
            <div class="field"><label><i class="fa-solid fa-phone"></i>Teléfono</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_tel"></div>
            <div class="field"><label><i class="fa-solid fa-fire-burner"></i>Gas</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_gas"></div>
            <div class="field"><label><i class="fa-solid fa-bus"></i>Transporte</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_trans"></div>
          </div>
          <div class="grid-3">
            <div class="field"><label><i class="fa-solid fa-shirt"></i>Vestuario</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_vest"></div>
            <div class="field"><label><i class="fa-solid fa-masks-theater"></i>Diversión</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_div"></div>
            <div class="field"><label><i class="fa-solid fa-gas-pump"></i>Combustible</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_comb"></div>
          </div>
          <div class="grid-2">
            <div class="field"><label><i class="fa-solid fa-plus"></i>Otros</label><input type="number" min="0" step="1" class="eg" value="0" id="eg_otros"></div>
            <div class="field"><label><i class="fa-solid fa-equals"></i>Total mensual (MXN)</label><input type="number" id="eg_total" readonly></div>
          </div>
        </div>

        <!-- 8. ALIMENTACIÓN -->
        <div class="step" data-step="8">
          <div class="field">
            <label><i class="fa-solid fa-utensils"></i>¿Qué comidas realiza al día?</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="comidas" value="Desayuno" /> Desayuno</label>
              <label class="chip"><input type="checkbox" name="comidas" value="Comida" /> Comida</label>
              <label class="chip"><input type="checkbox" name="comidas" value="Cena" /> Cena</label>
            </div>
          </div>

          <div class="field">
            <label><i class="fa-solid fa-bowl-food"></i>¿Con qué frecuencia consume estos alimentos?</label>
            <table>
              <thead><tr><th>Alimento</th><th>Frecuencia</th></tr></thead>
              <tbody id="freqBody"></tbody>
            </table>
          </div>
        </div>

        <!-- 9. DICTAMEN Y FIRMAS -->
        <div class="step" data-step="9">
          <div class="field">
            <label><i class="fa-solid fa-comment-dots"></i>Opinión de Trabajo Social</label>
            <textarea name="opinion_ts"></textarea>
          </div>

          <div class="grid-2">
            <div class="field">
              <label><i class="fa-solid fa-hand-holding-heart"></i>Plan social</label>
              <textarea name="plan_social"></textarea>
            </div>
            <div class="field">
              <label><i class="fa-solid fa-gifts"></i>Apoyo que recibe</label>
              <textarea name="apoyo_recibe"></textarea>
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label><i class="fa-solid fa-user-tie"></i>Nombre y firma de T.S.</label>
              <input type="text" name="firma_ts" placeholder="Nombre del Trabajador Social" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-stamp"></i>Sello</label>
              <input type="text" name="sello" />
            </div>
            <div class="field">
              <label><i class="fa-solid fa-user-pen"></i>Nombre y firma del entrevistado</label>
              <input type="text" name="firma_entrevistado" />
            </div>
          </div>
        </div>

        <!-- Controles -->
        <div class="acciones">
          <button type="button" class="btn" id="prev"><i class="fa-solid fa-arrow-left"></i> Anterior</button>
          <button type="button" class="btn primary" id="next">Siguiente <i class="fa-solid fa-arrow-right"></i></button>
          <button type="submit" class="btn gold" id="submit" style="display:none;"><i class="fa-solid fa-paper-plane"></i> Enviar</button>
        </div>
      </form>
    </section>

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="card" id="graficos">
        <h3><span><i class="fa-solid fa-chart-column"></i> Indicadores</span> <span class="tag">Demo</span></h3>
        <canvas id="chartIE"></canvas>
        <p class="desc"><i class="fa-solid fa-circle-info"></i> Se compara el total de ingresos vs egresos mensuales.</p>
      </div>

      <div class="card" id="mapas">
        <h3><span><i class="fa-solid fa-location-dot"></i> Mapa de localización</span> <span class="tag">Interactivo</span></h3>
        <div id="mapa"></div>
        <p class="desc"><i class="fa-solid fa-hand-pointer"></i> Usa “Ubicar domicilio” en el formulario.</p>
      </div>
    </aside>
  </main>

  <script>
    /* -------- Multipasos -------- */
    const steps = [...document.querySelectorAll('.step')];
    const pills = [...document.querySelectorAll('#pills .pill')];
    const bar = document.getElementById('bar');
    const btnPrev = document.getElementById('prev');
    const btnNext = document.getElementById('next');
    const btnSubmit = document.getElementById('submit');
    let current = 1;

    function renderSteps(){
      steps.forEach(s => s.classList.toggle('activo', Number(s.dataset.step)===current));
      pills.forEach((p,i)=>p.classList.toggle('activa', i+1===current));
      const pct = (current-1)/(steps.length-1)*100; bar.style.width = pct+'%';
      btnPrev.style.visibility = current===1 ? 'hidden':'visible';
      btnNext.style.display = current===steps.length ? 'none':'inline-flex';
      btnSubmit.style.display = current===steps.length ? 'inline-flex':'none';
    }
    btnPrev.onclick=()=>{ if(current>1){ current--; renderSteps(); } };
    btnNext.onclick=()=>{ if(current<steps.length){ current++; renderSteps(); } };
    renderSteps();

    /* -------- Edad automática -------- */
    const fnac = document.getElementById('fnac');
    const edad = document.getElementById('edad');
    fnac && fnac.addEventListener('change', ()=>{
      const d = new Date(fnac.value);
      if(!isNaN(d)){
        const hoy = new Date();
        let e = hoy.getFullYear()-d.getFullYear();
        const m = hoy.getMonth()-d.getMonth();
        if(m<0 || (m===0 && hoy.getDate()<d.getDate())) e--;
        edad.value = Math.max(0,e);
      }
    });

    /* -------- Tabla Estructura familiar -------- */
    const tbodyFam = document.querySelector('#tablaFamilia tbody');
    const btnAddFam = document.getElementById('agregarIntegrante');
    function filaFamilia(){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" placeholder="Apellidos y nombre(s)"></td>
        <td><input type="number" min="0" style="width:100px"></td>
        <td><input type="text" placeholder="Parentesco"></td>
        <td><input type="text" placeholder="Escolaridad"></td>
        <td><input type="text" placeholder="Ocupación"></td>
        <td style="text-align:center">
          <button type="button" class="btn" onclick="this.closest('tr').remove()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </td>
      `;
      return tr;
    }
    btnAddFam.onclick=()=>tbodyFam.appendChild(filaFamilia());
    tbodyFam.appendChild(filaFamilia());

    /* -------- Ingresos / Egresos y gráfico -------- */
    const ingInputs = ['ing_jefe','ing_esposa','ing_hijos','ing_otros'].map(id=>document.getElementById(id));
    const ingTotal = document.getElementById('ing_total');
    function totalIngresos(){ const t = ingInputs.reduce((a,i)=>a+Number(i.value||0),0); ingTotal.value=t; return t; }
    ingInputs.forEach(i=>i.addEventListener('input',()=>{ totalIngresos(); updateChart(); }));

    const egInputs = [...document.querySelectorAll('.eg')];
    const egTotal = document.getElementById('eg_total');
    function totalEgresos(){ const t = egInputs.reduce((a,i)=>a+Number(i.value||0),0); egTotal.value=t; return t; }
    egInputs.forEach(i=>i.addEventListener('input',()=>{ totalEgresos(); updateChart(); }));

    const ctx = document.getElementById('chartIE').getContext('2d');
    const chartIE = new Chart(ctx,{
      type:'bar',
      data:{labels:['Ingresos','Egresos'],
        datasets:[{label:'MXN',data:[0,0],backgroundColor:['#75142e','#bb935c'],borderColor:'#1b1b1b',borderWidth:1}]},
      options:{
        plugins:{legend:{display:false}},
        scales:{x:{ticks:{font:{size:11},color:'#1b1b1b'},grid:{display:false}},
                y:{beginAtZero:true,ticks:{font:{size:11},color:'#1b1b1b'},grid:{color:'#efe5e7'}}}
      }
    });
    function updateChart(){
      chartIE.data.datasets[0].data = [ totalIngresos(), totalEgresos() ];
      chartIE.update();
    }
    totalIngresos(); totalEgresos(); updateChart();

    /* -------- Frecuencias de alimentos -------- */
    const alimentos = ['Carne','Sopa','Huevo','Frijol','Frutas','Verduras','Tortillas','Refresco','Agua','Leche'];
    const freqs = ['Diario','3-5/semana','1-2/semana','Quincenal','Ocasional','Nunca'];
    const freqBody = document.getElementById('freqBody');
    alimentos.forEach(a=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${a}</td>
        <td><select>${freqs.map(f=>`<option>${f}</option>`).join('')}</select></td>`;
      freqBody.appendChild(tr);
    });

    /* -------- Mapa (Leaflet) + geocodificación -------- */
    const map = L.map('mapa').setView([20.09,-98.70], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; OpenStreetMap'}).addTo(map);
    let marker;

    function geocodificar(){
      const dom = document.querySelector('[name="domicilio"]').value.trim();
      const col = document.querySelector('[name="colonia"]').value.trim();
      if(!dom && !col){ alert('Capture al menos domicilio o colonia/localidad.'); return; }
      const q = encodeURIComponent(`${dom} ${col} Mineral de la Reforma, Hidalgo, México`);
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}&limit=1&addressdetails=1`,{headers:{'Accept-Language':'es'}})
        .then(r=>r.json()).then(data=>{
          if(data && data.length){
            const {lat,lon,display_name} = data[0];
            if(marker) marker.remove();
            marker = L.marker([+lat,+lon]).addTo(map);
            map.setView([+lat,+lon], 17);
            marker.bindPopup('<strong>Domicilio localizado</strong><br>'+display_name).openPopup();
          }else{
            alert('No se encontró el domicilio. Intente ser más específico.');
          }
        })
        .catch(()=>alert('Error al consultar la ubicación. Intente nuevamente.'));
    }
    document.getElementById('btnLocate1').addEventListener('click', geocodificar);

    /* -------- Envío (demo) -------- */
    document.getElementById('encuesta').addEventListener('submit', e=>{
      e.preventDefault();
      alert('Encuesta enviada (demo). Aquí se conectaría con tu API o base de datos institucional.');
    });
  </script>

</body>
</html>



